<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Quicksand&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Clicker+Script&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Amatic+SC&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Dancing+Script&display=swap">
    <link rel="stylesheet" href="https://unpkg.com/aos@2.3.1/dist/aos.css">
    <title>Cascina Nerchi üêêüßÄ</title>
    <style>
        section {
            display: flex;
        }

        body {
            background-color: #FFFFFF;
            display: inline;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 99%;
        }

        a {
            font-family: 'Amatic SC', sans-serif;
            font-size: 30px;
            color: #336699;
            margin-bottom: 30px;
            display: flex;
            align-self: center;
        }

        /* Fonts */

        .large-screen-font {
            text-align: center;
        }

        .small-screen-font {
            text-align: center;
        }

        p {
            margin: 0;
            justify-content: center;
            color: rgba(0, 0, 0, 1);
            font-family: 'Amatic SC', sans-serif;
        }

        body.large-screen-font p {
            font-size: 30px;
        }

        body.small-screen-font p {
            font-size: 25px;
        }

        h6 {
            margin: 0;
            justify-content: center;
            color: rgba(0, 0, 0, 1);
            font-family: 'Amatic SC', sans-serif;
            font-weight: 400;
        }

        body.large-screen-font h6 {
            font-size: 30px;
        }

        body.small-screen-font h6 {
            font-size: 20px;
        }

        h1 {
            color: rgb(0, 61, 117);
            font-family: 'Dancing Script', sans-serif;
            font-weight: 700;
        }

        body.large-screen-font h1 {
            font-size: 55px;
        }

        body.small-screen-font h1 {
            font-size: 40px;
        }

        h2 {
            color: #003C74;
            font-family: 'Amatic SC', sans-serif;
            font-weight: 700;
        }

        body.large-screen-font h2 {
            font-size: 40px;
        }

        body.small-screen-font h2 {
            font-size: 30px;
        }

        /* Utils */
        .shadow {
            overflow: hidden;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.0);
            background-color: rgba(65, 105, 225, 0.05);
        }

        .bold {
            font-weight: bold;
        }

        /* VS */
        .vertical-stack {
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .vertical-stack.large-screen {
            width: 100%;
            padding-left: 15px;
            padding-right: 15px;
        }

        .vertical-stack.small-screen {
            padding: 0px;
            margin: 0px;
        }

        .vertical-stack {
            padding-top: 15px;
            padding-bottom: 15px;
        }

        .vertical-stack p {
            padding-top: 15px;
            padding-bottom: 15px;
        }

        .vertical-stack section {
            padding-top: 8px;
            margin-bottom: 25px;
            width: 100%;
        }

        .vertical-stack .img-container {
            display: flex;
            justify-content: center;
        }

        .vertical-stack .right-text {
            display: flex;
            text-align: start;
            align-items: center;
        }

        /* HS */
        .horizontal-stack {
            display: flex;
            justify-content: space-evenly;
            align-items: center;
            max-height: 50%;
            padding-top: 15px;
            padding-bottom: 15px;
        }

        .horizontal-stack p {
            padding-left: 15px;
            padding-right: 15px;
        }

        .horizontal-stack section {
            width: 45%;
        }

        .horizontal-stack .img-container {
            padding-left: 15px;
        }

        .horizontal-stack .right-text {
            display: flex;
            justify-content: start;
        }

        /* VS-Flex  */

        .vertical-stack-flex {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding-left: 15px;
            padding-right: 15px;
            padding-top: 15px;
            padding-bottom: 15px;
        }

        .vertical-stack-flex p {
            padding-top: 15px;
            padding-bottom: 15px;
        }

        .vertical-stack-flex section {
            padding-top: 8px;
            margin-bottom: 25px;
            width: 100%;
        }

        /* Logo Image */
        .logo-img {
            max-width: 350px;
            height: auto;
            align-items: center;
        }

        .card-img {
            max-width: 75%;
            aspect-ratio: 1.3;
            align-items: center;
        }

        .large-screen-separator {
            max-width: 20%;
            height: auto;
            align-items: center;
        }

        /* Social Images */
        .img-container {
            display: flex;
            flex-direction: row;
        }

        .img-container img {
            width: 40px;
            height: 40px;
            padding-right: 10px;
        }

        /* Title and descriprion of sections */

        /* Image carousel */
        .carousel {
            display: flex;
            flex-direction: row;
            transition: transform 1s ease-in-out;
        }

        .carousel-mobile {
            display: flex;
            flex-direction: row;
            transition: transform 1s ease-in-out;
        }

        .carousel img {
            aspect-ratio: 1;
            width: 250px;
            padding-right: 25px;
            padding-left: 25px;
            opacity: 0.4;
            transition: opacity 1s ease-in-out;
        }

        .carousel-mobile img {
            aspect-ratio: 1;
            width: 400px;
            padding-right: 25px;
            padding-left: 25px;
            opacity: 0.4;
            transition: opacity 1s ease-in-out;
        }

        .carousel-mobile img.active {
            opacity: 1;
        }

        .carousel img.active {
            opacity: 1;
        }

        /* Controls for image carousel */
        .control-images {
            padding-top: 15px;
            padding-left: 15px;
            padding-right: 15px;
            width: 40px;
            aspect-ratio: 1;
        }

        .control-images-mobile {
            padding-top: 25px;
            padding-left: 10px;
            padding-right: 10px;
            width: 50px;
            aspect-ratio: 1;
        }

        .controls-section {
            width: 100%;
            display: flex;
            flex-direction: row;
            align-content: center;
            justify-content: center;
        }

        /* On-tap image modal*/
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            align-content: center;
            justify-content: center;
        }

        .modal-content {
            max-width: 100%;
            max-height: 100%;
            margin: auto;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .slogan {
            opacity: 0;
            animation: sloganEaseIn 3s forwards;
            animation-delay: 1.5s;
            text-shadow: none;
        }

        @keyframes sloganEaseIn {
            0% {
                opacity: 0;
            }

            50% {
                opacity: 1;
            }

            100% {
                opacity: 1;
                text-shadow: 8px 8px 8px rgba(0, 0, 0, 0.6);
            }
        }


        /* Border Animations */
        .container {
            border-radius: 3px;
            margin: 25px;
            position: relative;
            display: flex;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        .container.large-screen {
            width: 60%;
            height: 100%;
            margin: 30px;
        }

        .container.small-screen {
            width: 100%;
        }

        .border-top,
        .border-bottom,
        .border-right,
        .border-left {
            position: absolute;
            opacity: 0.8;
            animation-timing-function: cubic-bezier(0.8, 0, 0.2, 1);
            z-index: -1;
        }

        .border-top {
            top: 0;
            left: 0;
            width: 0%;
            height: 4px;
            background-color: #003C74;
        }

        .border-right {
            top: 0;
            right: 0;
            width: 4px;
            height: 0%;
            background-color: #003C74;
            animation-delay: 2.0s;
        }

        .border-bottom {
            bottom: 0;
            left: 0;
            width: 0%;
            height: 4px;
            background-color: #003C74;
            animation-delay: 2.0s;
        }

        .border-left {
            top: 4px;
            left: 0;
            width: 4px;
            height: 0%;
            background-color: #003C74;
        }

        @keyframes wrapBorderTop {
            0% {
                width: 0;
            }

            100% {
                width: calc(100% - 4px);

            }
        }

        @keyframes wrapBorderLeft {
            0% {
                height: 0;
            }

            100% {
                height: calc(100% - 8px);
            }
        }

        @keyframes wrapBorderRight {
            0% {
                height: 0;
            }

            100% {
                height: calc(100% - 4px);
            }
        }

        @keyframes wrapBorderBottom {
            0% {
                width: 0;
            }

            100% {
                width: 100%;
            }
        }

        /* Testing */
        .red {
            background-color: red;
        }

        .blue {
            background-color: blue;
        }
    </style>
</head>

<body class="large-screen-font" id="body">
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

    <div style="width: 100%; height: 100vh; display: flex; align-items: center; justify-content: center;">
        <div class="vertical-stack" style="padding-bottom: 20px;">
            <div id="mobile_vertical_stack_logo">
                <div class="horizontal-stack" data-aos="fade-up" data-aos-duration="2600"><img class="logo-img"
                        id="logo" src="home/cascina_nerchi.jpeg" alt="Your Logo">
                </div>
                <div class="vertical-stack">
                    <div class="right-text vertical-stack" id="contatti" data-aos="flip-down" data-aos-duration="2600">
                        <p style="padding-top: 0px; padding-bottom: 5px;">
                            <strong>Contatti</strong>
                        </p>
                        <p style="padding-top: 0px; padding-bottom: 5px;" id="tel"><strong>Tel</strong> </p>
                        <p style="padding-top: 0px;" id="mail">
                            <strong>Email</strong>
                        </p>
                    </div>
                    <div class="horizontal-stack img-container" data-aos="fade" data-aos-duration="2600">
                        <a href="https://www.instagram.com" id="instagram">
                            <img src="home/img1.jpeg" alt="Image 1">
                        </a>
                        <a href="https://www.facebook.com/profile.php?id=100064617106598" id="facebook">
                            <img src="home/img2.png" alt="Image 2">
                        </a>
                    </div>
                </div>
            </div>
            <div class="slogan">
                <h1 id="sloganTitolo">"Dal nostro pascolo alla tua tavola"</h1>
                <p id="sloganSottotitolo">Produzione latte e formaggi caprini, di mucca o misti.</p>
            </div>
        </div>
    </div>



    <div class="vertical-stack">

        <img class="large-screen-separator" src="home/separator.jpg">

        <div id="dynamicSections">

        </div>

        <img class="large-screen-separator" src="home/separator.jpg">

        <div class="horizontal-stack" style="margin: 15px;">
            <div class="container" style="margin: 15px">
                <div class="border-top"></div>
                <div class="border-right"></div>
                <div class="border-bottom"></div>
                <div class="border-left"></div>
                <div id="experiences" class="shadow large-screen">
                    <div class="vertical-stack small-screen" style="display:flex;">
                        <h1 style="margin: 15px;">Le nostre iniziative</h1>
                        <div id="iniziative" style="transition: opacity 1s;">
                            <h2 id="titoloIniziativa"></h2>
                            <img id="immagineIniziativa" src="" style="max-width: 45%;" class="immagineIniziativa">
                            <p id="descrizioneIniziativa"></p>
                        </div>
                        <a href="iniziative.html">Vedi tutto</a>
                    </div>
                </div>
            </div>
        </div>

        <img class="large-screen-separator" src="home/separator.jpg">

        <div class="horizontal-stack" style="margin: 15px; width: calc(100%-30px);">
            <div class="container" style="margin: 15px">
                <div class="border-top"></div>
                <div class="border-right"></div>
                <div class="border-bottom"></div>
                <div class="border-left"></div>
                <div id="timetable" class="shadow large-screen" style=" width: 100%;">
                    <div class="vertical-stack" style="width: 100%;">
                        <h1 style="margin: 15px;">I nostri orari</h1>
                        <div class="horizontal-stack" style="justify-content: space-evenly;">
                            <div class="vertical-stack" style="justify-content: space-between;" style="padding: 15px;">
                                <h6 class="bold">Mattino</h6>
                                <h6 id="mattino">Dalle 9<br>alle 12</h6>
                            </div>
                            <div class="vertical-stack" style="justify-content: space-between;" style="margin: 15px;">
                                <h6 class="bold">Pomeriggio</h6>
                                <h6 id="pomeriggio">Dalle 15<br>alle 18</h6>
                            </div>
                            <div class="vertical-stack" style="justify-content: space-between;" style="margin: 15px;">
                                <h6 class="bold">Siamo chiusi</h6>
                                <h6 id="giorniChiusura">Gioved√¨<br>Domenica</h6>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <img class="large-screen-separator" id="separator" src="home/separator.jpg">

        <div class="horizontal-stack">
            <div class="container" style="margin: 15px">
                <div class="border-top"></div>
                <div class="border-right"></div>
                <div class="border-bottom"></div>
                <div class="border-left"></div>
                <div class="shadow" style="overflow: hidden; margin: 4px;">
                    <div class="vertical-stack">
                        <h1>Galleria</h1>
                        <div id="carousel" class="carousel">

                        </div>
                        <div class="controls-section" style="margin: 10px;">
                            <img id="prev-arrow" class="control-images" src="carousel/chevron-left.png" alt="indietro">
                            <img id="next-arrow" class="control-images" src="carousel/chevron-right.png" alt="avanti">
                            <img id="play" class="control-images" src="carousel/play.png" alt="play">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <img class="large-screen-separator" src="home/separator.jpg">

        <div style="flex-direction: column; padding-bottom: 40px; padding-top: 20px; margin: 15px;">
            <h1>Dove ci puoi trovare?</h1>
            <p id="indirizzo">Localit√† Nerchi, 1, 15056 Dernice AL</p>
            <div id="mappa">
                <iframe
                    src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2833.4589463531042!2d9.027492176120154!3d44.751054080737745!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x47875b512168c53f%3A0xc23dfac8d557e75!2sCASCINA%20NERCHI!5e0!3m2!1sit!2sit!4v1693775233261!5m2!1sit!2sit"
                    width=90% height="400" style="border:0;" allowfullscreen="" loading="lazy"
                    referrerpolicy="no-referrer-when-downgrade"></iframe>
            </div>
            <p style="font-style: italic;" id="indicazioni">Partendo da Genova: uscite a Vignole Borbera,
                seguite le indicazioni per Cantalupo Ligure e poi verso Vigoponzo<br> -- <br>Partendo da Milano/Torino:
                uscite a Tortona e seguite le indicazioni per Garbagna, prima di Garbagna girate verso Dernice</p>
        </div>
    </div>

    <div id="image-modal" class="modal">
        <img id="full-screen-image" class="modal-content" onclick="closeFullScreenImage()" src="">
    </div>

    <script>

        let action;
        var descVS = [];
        var listener;
        var observer;

        function updateFlexDirection(
            containers,
            isMobileDevice,
            logoVS,
            territorio,
            product,
            timetable,
            exp,
            dynamicSections,
            fullScreenVS,
            description,
            carousel,
            logo,
            contatti,
            body,
            separators
        ) {
            console.log("UPDATE");
            if (isMobileDevice && window.innerWidth < 600) {
                logoVS.className = 'vertical-stack';
                descVS.forEach(VS => {
                    VS.className = 'vertical-stack-flex';
                });
                timetable.className = 'shadow small-screen';
                exp.className = 'shadow small-screen';
                contatti.style.textAlign = 'center';
                body.className = 'small-screen-font';
                fullScreenVS.forEach(VS => {
                    VS.className = 'shadow vertical-stack small-screen';
                });
                containers.forEach(cont => {
                    cont.className = 'container small-screen'
                }
                );
            } else if (isMobileDevice) {
                logoVS.className = 'vertical-stack';
                descVS.forEach(VS => {
                    VS.className = 'vertical-stack-flex';
                });
                timetable.className = 'shadow small-screen';
                exp.className = 'shadow small-screen';
                logo.style.maxWidth = '500px';
                body.className = 'small-screen-font';
                fullScreenVS.forEach(VS => {
                    VS.className = 'shadow vertical-stack small-screen';
                });
                containers.forEach(cont => {
                    cont.className = 'container small-screen'
                }
                );
            } else if (!isMobileDevice && window.innerWidth < 910) {
                logoVS.className = 'vertical-stack';
                descVS.forEach(VS => {
                    VS.className = 'vertical-stack-flex';
                });
                timetable.className = 'shadow small-screen';
                exp.className = 'shadow small-screen';
                contatti.style.alignItems = 'center';
                body.className = 'large-screen-font';
                fullScreenVS.forEach(VS => {
                    VS.className = 'shadow vertical-stack small-screen';
                });
                containers.forEach(cont => {
                    cont.className = 'container small-screen'
                }
                );
            } else if (!isMobileDevice) {
                logoVS.className = 'horizontal-stack';
                descVS.forEach(VS => {
                    VS.className = 'horizontal-stack';
                });
                timetable.className = 'shadow large-screen';
                exp.className = 'shadow large-screen';
                contatti.style.alignItems = 'start';
                body.className = 'large-screen-font';
                fullScreenVS.forEach(VS => {
                    VS.className = 'shadow vertical-stack large-screen';
                });
                containers.forEach(cont => {
                    cont.className = 'container large-screen'
                }
                );
            }

            return function (event) {
                updateFlexDirection(
                    containers,
                    isMobileDevice,
                    logoVS,
                    territorio,
                    product,
                    timetable,
                    exp,
                    dynamicSections,
                    fullScreenVS,
                    description,
                    carousel,
                    logo,
                    contatti,
                    body,
                    separators
                );
            }
        }

        function updatePage() {
            fetch('jsonData/data.json')
                .then(response => response.json())
                .then(data => {
                    const isChiusuraStagionale = data.chiusuraStagionale;
                    const mattinoElement = document.getElementById('mattino');
                    const pomeriggioElement = document.getElementById('pomeriggio');
                    const giorniChiusuraElement = document.getElementById('giorniChiusura');
                    if (isChiusuraStagionale) {
                        mattinoElement.innerHTML = `Chiuso`;
                        pomeriggioElement.innerHTML = `Chiuso`;
                        giorniChiusuraElement.innerHTML = "Tutto il mese, <br>per chiusura stagionale";
                    } else {
                        // Update morning timetable
                        const mattinaData = data.mattina;
                        if (mattinaData.length == 0) {
                            mattinoElement.innerHTML = `Chiuso`;
                        } else {
                            const mattinoTimings = mattinaData.join('<br>alle ');
                            mattinoElement.innerHTML = `Dalle ${mattinoTimings}`;
                        }
                        // Update afternoon timetable
                        const pomeriggioData = data.pomeriggio
                        if (pomeriggioData.length == 0) {
                            pomeriggioElement.innerHTML = `Chiuso`;
                        } else {
                            const pomeriggioTimings = pomeriggioData.join('<br>alle ');
                            pomeriggioElement.innerHTML = `Dalle ${pomeriggioTimings}`;
                        }

                        // Update closed days
                        giorniChiusuraElement.innerHTML = `${data.giorniChiusura.join('<br>')}`;
                    }
                })
                .catch(error => console.error('Error:', error));

            fetch('jsonData/homepageStatic.json')
                .then(response => response.json())
                .then(data => {
                    const contatti = data.contatti;
                    const slogan = data.slogan;
                    const pos = data.doveTrovarci;
                    // Get the <p> elements by their IDs
                    var telElement = document.getElementById("tel");
                    var mailElement = document.getElementById("mail");

                    // Update the inner HTML of the elements
                    telElement.innerHTML = `<strong>Tel</strong> ${contatti.tel}`;
                    mailElement.innerHTML = `<strong>Email</strong> ${contatti.email}`;

                    // Populate slogan elements
                    document.getElementById("sloganTitolo").textContent = `"` + data.slogan.titolo + `"`;
                    document.getElementById("sloganSottotitolo").textContent = data.slogan.sottotitolo;

                    // Populate doveTrovarci elements
                    document.getElementById("indirizzo").textContent = data.doveTrovarci.indirizzo;
                    document.getElementById("indicazioni").innerHTML = data.doveTrovarci.indicazioni;

                    document.getElementById("instagram").href = data.instagram;
                    document.getElementById("facebook").href = data.facebook;
                })
                .catch(error => console.error('Error:', error));

            fetch('jsonData/homepageDynamic.json')
                .then(response => response.json())
                .then(data => {
                    var ind = 0;
                    const dynamicSectionsContainer = document.getElementById('dynamicSections');
                    var currentSection;
                    var currentSectionData = '';
                    var lastDiv;

                    data.dynamicSections.forEach(sectionData => {
                        if (ind == 0) {
                            currentSection = document.createElement('div');
                            currentSection.classList.add('horizontal-stack');
                            console.log("a" + ind);
                            currentSection.innerHTML = `
  <div class="container">
    <div class="border-top"></div>
    <div class="border-right"></div>
    <div class="border-bottom"></div>
    <div class="border-left"></div>
    <div class="shadow vertical-stack large-screen" style="margin: 4px;">
      <h1>${sectionData.title}</h1>
      <img class="card-img" id="logo" style = "aspect-ratio: 1.5" src="${sectionData.image}">
      <p style="margin: 5px;">${sectionData.description}</p>
      ${sectionData.link !== null ? `<a href="${sectionData.link}">Scopri di pi√π</a>` : ''}
    </div>
  </div>`;

                            dynamicSectionsContainer.appendChild(currentSection);
                            ind++;
                        }
                        else if (ind % 2 == 1) {
                            currentSection = document.createElement('div');
                            currentSection.classList.add('horizontal-stack');
                            console.log("b" + ind);
                            currentSectionData = currentSectionData + `
                            <div class="container">
    <div class="border-top"></div>
    <div class="border-right"></div>
    <div class="border-bottom"></div>
    <div class="border-left"></div>
            <section class="shadow vertical-stack large-screen" style="margin: 4px;">
                <h1>${sectionData.title}</h1>
                <img class="card-img" id="logo" src="${sectionData.image}">
                <p style="margin: 5px;">${sectionData.description}</p>
                ${sectionData.link !== null ? `<a href="${sectionData.link}">Scopri di pi√π</a>` : ''}
            </section>
            </div>
        `;
                            if (ind == dynamicSections.length - 1) {
                                currentSection.innerHTML = currentSectionData;
                                dynamicSectionsContainer.appendChild(currentSection);
                                currentSectionData = ''
                                descVS.push(currentSection);
                            }
                            ind++;
                        } else {
                            console.log("c" + ind + ind % 2);
                            currentSectionData = currentSectionData + `
                            <div class="container">
    <div class="border-top"></div>
    <div class="border-right"></div>
    <div class="border-bottom"></div>
    <div class="border-left"></div>
            <section class="shadow vertical-stack large-screen" style="margin: 4px;">
                <h1>${sectionData.title}</h1>
                <img class="card-img" id="logo" src="${sectionData.image}">
                <p style="margin: 5px;">${sectionData.description}</p>
                ${sectionData.link !== null ? `<a href="${sectionData.link}">Scopri di pi√π</a>` : ''}
            </section>
            </div>
        `;
                            currentSection.innerHTML = currentSectionData;
                            dynamicSectionsContainer.appendChild(currentSection);
                            currentSectionData = ''
                            descVS.push(currentSection);
                        }
                    });

                })
                .catch(error => console.error('Error:', error));

            fetch('jsonData/carouselImages.json')
                .then(response => response.json())
                .then(data => {

                    const carouselContainer = document.getElementById('carousel');

                    data.carouselImage.forEach((imageUrl, index) => {
                        const imgElement = document.createElement('img');
                        imgElement.src = imageUrl;
                        imgElement.alt = `Image ${index + 1}`;
                        imgElement.onclick = () => showFullScreenImage(imgElement);

                        carouselContainer.appendChild(imgElement);
                    });

                    for (let index = 0; index <= 4; index++) {
                        const imgElement = document.createElement('img');
                        imgElement.src = data.carouselImage[index];
                        imgElement.alt = `LastImages ${index + 1}`;
                        imgElement.onclick = () => showFullScreenImage(imgElement);

                        carouselContainer.appendChild(imgElement);
                    }

                    AOS.init();

                })
                .then(ok => {
                    // --- Carousel fonctionality 
                    const images = carousel.querySelectorAll("img");
                    const firstImage = carousel.querySelector("img");
                    const nextArrow = document.getElementById("next-arrow");
                    const prevArrow = document.getElementById("prev-arrow");
                    const play = document.getElementById("play");

                    let currentImageIndex = 0;
                    var offset;

                    firstImage.onload = function () {
                        offset = 300;
                    }

                    function showImage(index) {
                        images.forEach((image, i) => {
                            if (i === index) {
                                image.classList.add("active");
                            } else {
                                image.classList.remove("active");
                            }
                        });
                    }

                    function scrollCarousel(index) {
                        const scrollPosition = -offset * index;
                        carousel.style.transform = `translateX(${scrollPosition}px)`;
                    }

                    function nextImage() {
                        currentImageIndex = (currentImageIndex + 1) % (images.length - 5);
                        showImage(currentImageIndex);
                        scrollCarousel(currentImageIndex);
                    }

                    function prevImage() {
                        if (currentImageIndex != 0) {
                            currentImageIndex = (currentImageIndex - 1) % images.length;
                            showImage(currentImageIndex);
                            scrollCarousel(currentImageIndex);
                        }
                    }

                    // Initial display
                    showImage(currentImageIndex);
                    scrollCarousel(currentImageIndex)

                    // Automatically change images every 3 seconds
                    function startAutoSlide() {
                        action = setInterval(nextImage, 3000);
                    }

                    startAutoSlide()

                    nextArrow.addEventListener("click", function () {
                        clearInterval(action);
                        nextImage();
                    });
                    prevArrow.addEventListener("click", function () {
                        clearInterval(action);
                        prevImage();
                    });
                    play.addEventListener("click", function () {
                        nextImage()
                        clearInterval(action);
                        startAutoSlide() // Stop automatic sliding on arrow click
                    });

                    // Reset the carousel to the beginning without a roll-back effect
                    function resetCarousel() {
                        showImage(currentImageIndex);
                        scrollCarousel(currentImageIndex);
                    }

                    // When the last image finishes transitioning, reset the carousel
                    carousel.addEventListener("transitionend", function (event) {
                        if (event.propertyName === "transform" && currentImageIndex >= images.length - 5) {
                            currentImageIndex = 0;
                            resetCarousel();
                        }
                    });
                })
                .then(ok => {
                    // add animation listeners
                    elements = []
                    const containers = Array.from(document.querySelectorAll('.container'));
                    elements[0] = Array.from(document.querySelectorAll('.border-top'));
                    elements[1] = Array.from(document.querySelectorAll('.border-right'));
                    elements[2] = Array.from(document.querySelectorAll('.border-left'));
                    elements[3] = Array.from(document.querySelectorAll('.border-bottom'));

                    const keyframes = [
                        {
                            boxShadow: '0px 0px 0px rgba(0, 0, 0, 0.0)',
                            opacity: 0,
                            transform: 'translateY(50px)',
                            easing: 'ease-out'
                        },
                        {
                            boxShadow: '15px 15px 20px rgba(0, 0, 0, 0.5)',
                            opacity: 1,
                            transform: 'translateY(0)',
                            easing: 'ease-out'
                        }
                    ];

                    const options = {
                        duration: 2000, // 2 seconds
                        delay: 500,    // 0.5 second delay
                        fill: 'both'
                    };

                    // Define a callback function to handle intersections
                    function handleIntersection(entries, observer) {
                        entries.forEach(entry => {
                            if (entry.isIntersecting) {
                                entry.target.animate(keyframes, options);
                                var k = -1;
                                for (i = 0; i < containers.length + 1; i++) {
                                    if (entry.target === containers[i]) {
                                        k = i;
                                        break;
                                    }
                                }
                                if (k != -1) {
                                    setTimeout(function () {
                                        elements[0][k].style.animation = 'wrapBorderTop 2s forwards';
                                        elements[1][k].style.animation = 'wrapBorderRight 2s forwards';
                                        elements[1][k].style.animationDelay = '2s';
                                        elements[2][k].style.animation = 'wrapBorderLeft 2s forwards';
                                        elements[3][k].style.animation = 'wrapBorderBottom 2s forwards';
                                        elements[3][k].style.animationDelay = '2s';
                                    }, 2700);
                                }
                            } else {
                                entry.target.style = "boxShadow: '0px 0px 0px rgba(0, 0, 0, 0.0)', opacity: 0, transform: 'translateY(50px)'"
                                var k = -1;
                                console.log(k);
                                for (i = 0; i < containers.length + 1; i++) {
                                    if (entry.target === containers[i]) {
                                        k = i;
                                        break;
                                    }
                                }
                                if (k != -1) {
                                    elements[0][k].style.animation = 'none';
                                    elements[1][k].style.animation = 'none';
                                    elements[2][k].style.animation = 'none';
                                    elements[3][k].style.animation = 'none';
                                    elements[0][k].offsetHeight;
                                    elements[1][k].offsetHeight;
                                    elements[2][k].offsetHeight;
                                    elements[3][k].offsetHeight;
                                }
                            }
                        });
                    }
                    // Create an observer instance
                    observer = new IntersectionObserver(handleIntersection);

                    containers.forEach(element => {
                        observer.observe(element);
                    });

                })
                .then(ok => {
                    // --- Handle different screen sizes
                    const logoVS = document.getElementById('mobile_vertical_stack_logo');
                    const territorio = document.getElementById('territorio');
                    const product = document.getElementById('product');
                    const timetable = document.getElementById('timetable');
                    const exp = document.getElementById('experiences');
                    const dynamicSections = document.getElementById('dynamicSections');
                    const HS = dynamicSections.querySelectorAll('.horizontal-stack');
                    var fullScreenVS = [];
                    HS.forEach(hs => {
                        hs.querySelectorAll(".large-screen").forEach(VS => {
                            fullScreenVS.push(VS);
                        });
                    });
                    containers = document.querySelectorAll('.container')
                    const description = document.getElementById('mobile_fullScreen_desc');
                    const carousel = document.getElementById('carousel');
                    const logo = document.getElementById('logo');
                    const contatti = document.getElementById('contatti');
                    const body = document.getElementById('body');
                    const separators = document.querySelectorAll("large-screen-separator");

                    const isMobileDevice = /Mobi|Android/i.test(navigator.userAgent);

                    console.log(dynamicSections);
                    console.log(HS);
                    console.log(fullScreenVS);

                    // Initial call to set the layout based on the window width
                    updateFlexDirection(
                        containers,
                        isMobileDevice,
                        logoVS,
                        territorio,
                        product,
                        timetable,
                        exp,
                        dynamicSections,
                        fullScreenVS,
                        description,
                        carousel,
                        logo,
                        contatti,
                        body,
                        separators
                    );

                    // Add a listener for the window's resize event
                    listener = window.addEventListener('resize', updateFlexDirection(
                        containers,
                        isMobileDevice,
                        logoVS,
                        territorio,
                        product,
                        timetable,
                        exp,
                        dynamicSections,
                        fullScreenVS,
                        description,
                        carousel,
                        logo,
                        contatti,
                        body,
                        separators
                    ));
                }
                ).catch(error => console.error('Error:', error));
        }


        // Call the function to update the timetable
        updatePage();

        // -- iniziativeCarousel functionality 

        const titleElement = document.getElementById("titoloIniziativa");
        const imageElement = document.getElementById("immagineIniziativa");
        const descriptionElement = document.getElementById("descrizioneIniziativa");
        const container = document.getElementById('iniziative');

        let esperienze;
        let currentExp = 0;
        let delay = 0;

        function updateContent(index) {
            const iniziativa = esperienze[index];
            container.style.opacity = 0;

            const keyframes = [
                { boxShadow: '0px 0px 0px rgba(0, 0, 0, 0.0)' },
                { boxShadow: '5px 10px 25px rgba(0, 0, 0, 0.9)' }
            ];

            const options = {
                duration: 3000, // 3 seconds
                delay: 0,    // 1 second delay
                fill: 'forwards'
            };

            setTimeout(function () {
                imageElement.onload = function () {
                    titleElement.textContent = iniziativa.titolo;
                    descriptionElement.textContent = iniziativa.descrizione;
                    container.style.opacity = 1;
                    immagineIniziativa.animate(keyframes, options);
                }
                imageElement.src = iniziativa.immagine;
                currentExp = (index + 1) % esperienze.length;
            }, delay);

            delay = 800;
        }

        async function getExperiences() {
            try {
                const response = await fetch('jsonData/esperienze.json');
                const data = await response.json();
                esperienze = data.esperienze;
                console.log(esperienze);

                //set first experience as default
                updateContent(currentExp);
            } catch (error) {
                console.error('Error fetching data:', error);
            }
        }

        getExperiences();
        setInterval(() => updateContent(currentExp), 8000);

        // --- Handle full screen images 

        function showFullScreenImage(image) {
            const modal = document.getElementById("image-modal");
            const fullScreenImage = document.getElementById("full-screen-image");

            modal.style.backgroundColor = "rgba(0, 0, 0, 0.9)";
            fullScreenImage.src = image.src;
            modal.style.display = "block";
        }

        function closeFullScreenImage() {
            const modal = document.getElementById("image-modal");
            modal.style.display = "none";
        }

        window.onclick = function (event) {
            const modal = document.getElementById("image-modal");
            if (event.target === modal) {
                modal.style.display = "none";
            }
        };

    </script>


</body>

</html>